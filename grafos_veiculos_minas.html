<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roteamento de Ve√≠culos com Janela de Tempo - Minera√ß√£o</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.2em;
        }

        .controls {
            text-align: center;
            margin-bottom: 30px;
        }

        button {
            background: linear-gradient(45deg, #e67e22, #d35400);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .main-content {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .graph-container {
            flex: 2;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            min-height: 650px;
            border: 3px solid #34495e;
        }

        .info-panel {
            flex: 1;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        /* Elementos do Grafo */
        .mine {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #8b4513, #654321);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            z-index: 10;
            border: 3px solid #2c3e50;
        }

        .mine::before {
            content: '‚õèÔ∏è';
            font-size: 24px;
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
        }

        .mine.highlighted {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            animation: pulse 1s infinite;
            border-color: #e74c3c;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .road {
            position: absolute;
            background: #34495e;
            height: 4px;
            transform-origin: left center;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .road.highlighted {
            background: #e74c3c;
            height: 6px;
            animation: glow 1s infinite;
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px #e74c3c; }
            50% { box-shadow: 0 0 15px #e74c3c; }
            100% { box-shadow: 0 0 5px #e74c3c; }
        }

        .road-label {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            z-index: 5;
            color: #2c3e50;
            white-space: nowrap;
            border: 1px solid #34495e;
        }

        .road-label.best-route {
            background: rgba(46, 204, 113, 0.9);
            color: white;
            border-color: #27ae60;
        }

        /* Caminh√µes */
        .truck {
            position: absolute;
            width: 30px;
            height: 20px;
            background: #f39c12;
            border-radius: 3px;
            z-index: 8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            border: 2px solid #d35400;
        }

        .truck::before {
            content: 'üöõ';
            font-size: 16px;
        }

        .main-truck {
            background: #e74c3c;
            border-color: #c0392b;
            width: 35px;
            height: 25px;
            animation: truck-pulse 2s infinite;
        }

        .main-truck::before {
            content: 'üöö';
            font-size: 18px;
        }

        @keyframes truck-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .queue-area {
            position: absolute;
            background: rgba(52, 73, 94, 0.1);
            border: 2px dashed #34495e;
            border-radius: 5px;
            z-index: 2;
            padding: 5px;
        }

        .mine-info {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            color: #2c3e50;
            border: 2px solid #34495e;
            z-index: 6;
        }

        /* Info Panel */
        .step-info {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }

        .calculation {
            background: #d5f4e6;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        .algorithm-step {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }

        .best-choice {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
            text-align: center;
            border: 2px solid #28a745;
        }

        .legend {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .legend-icon {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }

        .formula {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöõ Roteamento de Ve√≠culos com Janela de Tempo</h1>
        <p class="subtitle">Otimiza√ß√£o de Rotas para Caminh√µes de Minera√ß√£o</p>
        
        <div class="controls">
            <button onclick="startAnimation()">Iniciar Simula√ß√£o</button>
            <button onclick="nextStep()" id="nextBtn" disabled>Pr√≥ximo Passo</button>
            <button onclick="resetAnimation()">Reiniciar</button>
        </div>

        <div class="main-content">
            <div class="graph-container" id="graphContainer">
                <h3>üèóÔ∏è Rede de Minas e Caminhos</h3>
                <!-- Elementos ser√£o criados dinamicamente -->
            </div>

            <div class="info-panel">
                <div class="legend">
                    <h4>üìã Legenda</h4>
                    <div class="legend-item">
                        <div class="legend-icon" style="background: #8b4513; border-radius: 50%;">‚õèÔ∏è</div>
                        <span>Minas de Min√©rio</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background: #e74c3c;">üöö</div>
                        <span>Caminh√£o Principal</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background: #f39c12;">üöõ</div>
                        <span>Caminh√µes na Fila</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="background: #34495e;"></div>
                        <span>Estradas</span>
                    </div>
                </div>

                <div class="formula">
                    <strong>F√≥rmula de C√°lculo:</strong><br>
                    Peso = Dist√¢ncia + (Tempo_Fila √ó 2)
                </div>

                <div id="stepInfo">
                    <div class="step-info">
                        <h4>Como funciona?</h4>
                        <p>O <strong>caminh√£o principal</strong> (vermelho) precisa escolher qual mina visitar.</p>
                        <p>O algoritmo considera tanto a <strong>dist√¢ncia</strong> quanto o <strong>tempo de espera</strong> na fila.</p>
                        <p><strong>Tempo de carregamento:</strong> Cada caminh√£o leva <strong>5 minutos</strong> para carregar.</p>
                        <p>Clique em "Iniciar Simula√ß√£o" para ver o processo!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados das minas
        const mineData = {
            'Mina A': { x: 150, y: 150, queue: 1, loadTime: 5 },
            'Mina B': { x: 500, y: 100, queue: 3, loadTime: 5 },
            'Mina C': { x: 650, y: 350, queue: 0, loadTime: 5 },
            'Mina D': { x: 300, y: 480, queue: 2, loadTime: 5 }
        };

        // Posi√ß√£o do caminh√£o principal (exatamente no centro de interse√ß√£o das arestas)
        const mainTruck = { x: 375, y: 290 };

        // Dist√¢ncias entre caminh√£o e minas (em km)
        const distances = {
            'Mina A': 8,
            'Mina B': 12,
            'Mina C': 15,
            'Mina D': 6
        };

        let currentStep = 0;
        let animationRunning = false;
        let calculatedWeights = {};
        let bestMine = '';

        function createScene() {
            const container = document.getElementById('graphContainer');
            
            // Limpar cena existente - incluir main-truck na limpeza
            const existingElements = container.querySelectorAll('.mine, .road, .road-label, .truck, .main-truck, .queue-area, .mine-info');
            existingElements.forEach(el => el.remove());

            // Criar caminh√£o principal (centralizado no ponto de origem das estradas)
            const truck = document.createElement('div');
            truck.className = 'main-truck';
            truck.id = 'main-truck';
            // Ajustar posi√ß√£o para que o centro do caminh√£o coincida com o ponto de origem das estradas
            // Caminh√£o tem 35px x 25px, ent√£o subtrair metade para centralizar
            truck.style.left = `${mainTruck.x - 17.5}px`;
            truck.style.top = `${mainTruck.y - 12.5}px`;
            truck.title = 'Caminh√£o Principal';
            container.appendChild(truck);

            // Criar minas
            Object.keys(mineData).forEach(mineName => {
                const mine = mineData[mineName];
                
                // Mina
                const mineElement = document.createElement('div');
                mineElement.className = 'mine';
                mineElement.id = `mine-${mineName}`;
                mineElement.textContent = mineName;
                mineElement.style.left = `${mine.x}px`;
                mineElement.style.top = `${mine.y}px`;
                container.appendChild(mineElement);

                // √Årea da fila
                if (mine.queue > 0) {
                    const queueArea = document.createElement('div');
                    queueArea.className = 'queue-area';
                    queueArea.style.left = `${mine.x + 90}px`;
                    queueArea.style.top = `${mine.y + 10}px`;
                    queueArea.style.width = `${mine.queue * 35 + 10}px`;
                    queueArea.style.height = '60px';
                    container.appendChild(queueArea);

                    // Caminh√µes na fila
                    for (let i = 0; i < mine.queue; i++) {
                        const queueTruck = document.createElement('div');
                        queueTruck.className = 'truck';
                        queueTruck.style.left = `${mine.x + 95 + (i * 35)}px`;
                        queueTruck.style.top = `${mine.y + 25}px`;
                        queueTruck.title = `Caminh√£o ${i + 1} na fila`;
                        container.appendChild(queueTruck);
                    }
                }

                // Info da mina
                const mineInfo = document.createElement('div');
                mineInfo.className = 'mine-info';
                mineInfo.innerHTML = `
                    <strong>${mineName}</strong><br>
                    Fila: ${mine.queue} caminh√µes<br>
                    Dist: ${distances[mineName]}km
                `;
                mineInfo.style.left = `${mine.x}px`;
                mineInfo.style.top = `${mine.y - 60}px`;
                container.appendChild(mineInfo);

                // Estrada
                createRoad(mainTruck, mine, mineName);
            });
        }

        function createRoad(from, to, mineName) {
            const container = document.getElementById('graphContainer');
            
            // Calcular do centro do caminh√£o para o centro da mina
            const dx = to.x + 40 - from.x; // Centro do caminh√£o para centro da mina
            const dy = to.y + 40 - from.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;

            const road = document.createElement('div');
            road.className = 'road';
            road.id = `road-${mineName}`;
            road.style.left = `${from.x}px`; // Partir exatamente do centro do caminh√£o
            road.style.top = `${from.y}px`;
            road.style.width = `${length}px`;
            road.style.transform = `rotate(${angle}deg)`;
            container.appendChild(road);

            // Label da estrada (peso ser√° calculado dinamicamente)
            const label = document.createElement('div');
            label.className = 'road-label';
            label.id = `label-${mineName}`;
            label.style.left = `${from.x + dx/2}px`;
            label.style.top = `${from.y + dy/2 - 10}px`;
            container.appendChild(label);
        }

        function calculateWeights() {
            calculatedWeights = {};
            let minWeight = Infinity;
            bestMine = '';

            Object.keys(mineData).forEach(mineName => {
                const mine = mineData[mineName];
                const distance = distances[mineName];
                const queueTime = mine.queue * mine.loadTime;
                const weight = distance + (queueTime * 2); // Fator 2 para penalizar tempo de espera
                
                calculatedWeights[mineName] = {
                    distance: distance,
                    queueTime: queueTime,
                    weight: weight
                };

                if (weight < minWeight) {
                    minWeight = weight;
                    bestMine = mineName;
                }
            });
        }

        function showWeights() {
            // Atualizar labels das estradas com os pesos calculados
            Object.keys(calculatedWeights).forEach(mineName => {
                const label = document.getElementById(`label-${mineName}`);
                if (label) {
                    label.textContent = `${calculatedWeights[mineName].weight}`;
                    label.style.display = 'block'; // Mostrar label
                    if (mineName === bestMine) {
                        label.classList.add('best-route');
                    }
                }
            });
        }

        function hideWeights() {
            // Esconder labels das estradas
            Object.keys(mineData).forEach(mineName => {
                const label = document.getElementById(`label-${mineName}`);
                if (label) {
                    label.style.display = 'none';
                    label.classList.remove('best-route');
                }
            });
        }

        function highlightMine(mineName) {
            // Limpar highlights anteriores
            document.querySelectorAll('.mine').forEach(mine => {
                mine.classList.remove('highlighted');
            });
            document.querySelectorAll('.road').forEach(road => {
                road.classList.remove('highlighted');
            });

            // Destacar mina e estrada
            if (mineName) {
                const mine = document.getElementById(`mine-${mineName}`);
                const road = document.getElementById(`road-${mineName}`);
                if (mine) mine.classList.add('highlighted');
                if (road) road.classList.add('highlighted');
            }
        }

        function updateStepInfo(step) {
            const stepInfo = document.getElementById('stepInfo');
            
            switch(step) {
                case 0:
                    stepInfo.innerHTML = `
                        <div class="step-info">
                            <h4>üéØ Situa√ß√£o Inicial</h4>
                            <p>O <strong>caminh√£o principal</strong> est√° na posi√ß√£o inicial e precisa escolher uma mina.</p>
                            <p><strong>An√°lise das op√ß√µes:</strong></p>
                            <ul>
                                <li>Mina A: ${mineData['Mina A'].queue} caminh√µes na fila</li>
                                <li>Mina B: ${mineData['Mina B'].queue} caminh√µes na fila</li>
                                <li>Mina C: ${mineData['Mina C'].queue} caminh√µes na fila</li>
                                <li>Mina D: ${mineData['Mina D'].queue} caminh√µes na fila</li>
                            </ul>
                        </div>
                    `;
                    break;

                case 1:
                    stepInfo.innerHTML = `
                        <div class="algorithm-step">
                            <h4>üßÆ Calculando Pesos das Rotas</h4>
                            <p>Para cada mina, calculamos: <strong>Peso = Dist√¢ncia + (Tempo_Fila √ó 2)</strong></p>
                        </div>
                        <div class="calculation">
                            <strong>C√°lculos:</strong><br>
                            Mina A: ${calculatedWeights['Mina A'].distance} + (${calculatedWeights['Mina A'].queueTime} √ó 2) = <strong>${calculatedWeights['Mina A'].weight}</strong><br>
                            Mina B: ${calculatedWeights['Mina B'].distance} + (${calculatedWeights['Mina B'].queueTime} √ó 2) = <strong>${calculatedWeights['Mina B'].weight}</strong><br>
                            Mina C: ${calculatedWeights['Mina C'].distance} + (${calculatedWeights['Mina C'].queueTime} √ó 2) = <strong>${calculatedWeights['Mina C'].weight}</strong><br>
                            Mina D: ${calculatedWeights['Mina D'].distance} + (${calculatedWeights['Mina D'].queueTime} √ó 2) = <strong>${calculatedWeights['Mina D'].weight}</strong>
                        </div>
                    `;
                    break;

                case 2:
                    const bestData = calculatedWeights[bestMine];
                    stepInfo.innerHTML = `
                        <div class="algorithm-step">
                            <h4>üéØ An√°lise da Melhor Rota</h4>
                            <p>Comparando todos os pesos calculados...</p>
                        </div>
                        <div class="best-choice">
                            <h4>üèÜ MELHOR ESCOLHA: ${bestMine}</h4>
                            <p>Peso Total: <strong>${bestData.weight}</strong></p>
                            <p>Dist√¢ncia: ${bestData.distance}km | Tempo Fila: ${bestData.queueTime} min</p>
                        </div>
                    `;
                    highlightMine(bestMine);
                    break;

                case 3:
                    stepInfo.innerHTML = `
                        <div class="algorithm-step">
                            <h4>‚úÖ Decis√£o Final</h4>
                            <p>O algoritmo determinou que a <strong>${bestMine}</strong> √© a melhor op√ß√£o!</p>
                            <p><strong>Raz√£o:</strong> Menor peso total considerando dist√¢ncia e tempo de espera.</p>
                        </div>
                        <div class="step-info">
                            <h4>üí° Benef√≠cios do Algoritmo</h4>
                            <ul>
                                <li><strong>Efici√™ncia:</strong> Reduz tempo total de opera√ß√£o</li>
                                <li><strong>Balanceamento:</strong> Evita sobrecarga de minas espec√≠ficas</li>
                                <li><strong>Flexibilidade:</strong> Adapta-se dinamicamente √†s condi√ß√µes</li>
                            </ul>
                        </div>
                    `;
                    break;
            }
        }

        function startAnimation() {
            animationRunning = true;
            currentStep = 0;
            document.getElementById('nextBtn').disabled = false;
            createScene();
            calculateWeights();
            hideWeights(); // Esconder pesos inicialmente
            updateStepInfo(0);
        }

        function nextStep() {
            if (currentStep < 3) {
                currentStep++;
                
                // Mostrar pesos no passo 1 (quando mostra c√°lculos)
                if (currentStep === 1) {
                    showWeights();
                }
                
                updateStepInfo(currentStep);
                
                if (currentStep >= 3) {
                    document.getElementById('nextBtn').disabled = true;
                }
            }
        }

        function resetAnimation() {
            animationRunning = false;
            currentStep = 0;
            document.getElementById('nextBtn').disabled = true;
            createScene();
            hideWeights(); // Esconder pesos ao reiniciar
            
            document.getElementById('stepInfo').innerHTML = `
                <div class="step-info">
                    <h4>Como funciona?</h4>
                    <p>O <strong>caminh√£o principal</strong> (vermelho) precisa escolher qual mina visitar.</p>
                    <p>O algoritmo considera tanto a <strong>dist√¢ncia</strong> quanto o <strong>tempo de espera</strong> na fila.</p>
                    <p><strong>Tempo de carregamento:</strong> Cada caminh√£o leva <strong>5 minutos</strong> para carregar.</p>
                    <p>Clique em "Iniciar Simula√ß√£o" para ver o processo!</p>
                </div>
            `;

            // Limpar highlights
            highlightMine(null);
        }

        // Inicializar a cena
        document.addEventListener('DOMContentLoaded', function() {
            createScene();
            // Esconder pesos na inicializa√ß√£o
            setTimeout(() => {
                hideWeights();
            }, 100);
        });
    </script>
</body>
</html>